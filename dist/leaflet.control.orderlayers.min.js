/*! leaflet.control.orderlayers 08-10-2016 */
L.Control.OrderLayers=L.Control.Layers.extend({options:{title:"Layer Manager",order:"normal",showBaselayers:!0,draggging:!1},onAdd:function(a){return this._initLayout(),this._update(),this.options.draggging&&this._addDranAndDrop(),a.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this).on("changeorder",this._onLayerChange,this),this._container},onRemove:function(a){a.off("layeradd",this._onLayerChange).off("layerremove",this._onLayerChange).off("changeorder",this._onLayerChange)},_initLayout:function(){var a="leaflet-control-layers",b=this._container=L.DomUtil.create("div",a);b.setAttribute("aria-haspopup",!0),L.Browser.touch?L.DomEvent.on(b,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(b),L.DomEvent.on(b,"mousewheel",L.DomEvent.stopPropagation));var c=this._form=L.DomUtil.create("form",a+"-list");if(this.options.collapsed){L.Browser.android||L.DomEvent.on(b,"mouseover",this._expand,this).on(b,"mouseout",this._collapse,this);var d=this._layersLink=L.DomUtil.create("a",a+"-toggle",b);d.href="#",d.title="Layers",L.Browser.touch?L.DomEvent.on(d,"click",L.DomEvent.stop).on(d,"click",this._expand,this):L.DomEvent.on(d,"focus",this._expand,this),this._map.on("click",this._collapse,this)}else this._expand();if(this.options.title){var e=L.DomUtil.create("h3",a+"-title");e.innerHTML=this.options.title,c.appendChild(e)}this._baseLayersList=L.DomUtil.create("div",a+"-base",c),this._separator=L.DomUtil.create("div",a+"-separator",c),this._overlaysList=L.DomUtil.create("div",a+"-overlays",c),b.appendChild(c)},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="";var a,b,c=!1,d=!1,e=[];for(a in this._layers){if(b=this._layers[a],b.overlay){if(b.layer.options&&b.layer.options.zIndex)e[b.layer.options.zIndex]=b;else if(b.layer.getLayers&&b.layer.eachLayer){var f=9999999999;b.layer.eachLayer(function(a){a.options&&a.options.zIndex&&(f=Math.min(a.options.zIndex,f))}),e[f]=b}}else this._addItem(b);d=d||b.overlay,c=c||!b.overlay}if("normal"===this.options.order)for(a=0;a<e.length;a++)e[a]&&this._addItem(e[a]);else for(a=e.length-1;a>=0;a--)e[a]&&this._addItem(e[a]);L.DomUtil.create("div","clearfix",this._baseLayersList),L.DomUtil.create("div","clearfix",this._overlaysList),this._separator.style.display=d&&c?"":"none"}},_addDranAndDrop:function(){var a=this;Sortable.create(this._overlaysList,{onMove:function(b,c){var d=a._layers[b.dragged.layerId],e=a._layers[b.related.layerId],f=a._getZIndex(d),g=a._getZIndex(e);d.layer.setZIndex(g),e.layer.setZIndex(f)}})},_addItem:function(a){var b,c=L.DomUtil.create("div","leaflet-row"),d=L.DomUtil.create("label",""),e=this._map.hasLayer(a.layer);a.overlay?(b=L.DomUtil.create("input"),b.type="checkbox",b.className="leaflet-control-layers-selector",b.defaultChecked=e):b=this._createRadioElement("leaflet-base-layers",e),b.layerId=L.stamp(a.layer),b.id="lf."+b.layerId,this.options.draggging&&(c.layerId=b.layerId),L.DomEvent.on(b,"click",this._onInputClick,this);var f=document.createElement("span");f.innerHTML=" "+a.name;var g=L.DomUtil.create("div","leaflet-input");g.appendChild(b);var h=L.DomUtil.create("label","leaflet-icon");h.htmlFor=b.id,g.appendChild(h),c.appendChild(g),g=L.DomUtil.create("div","leaflet-name"),d.htmlFor=b.id,g.appendChild(d),c.appendChild(g),d.appendChild(f);var i;return a.overlay?(this.options.draggging||(g=L.DomUtil.create("div","leaflet-up"),L.DomEvent.on(g,"click","normal"===this.options.order?this._onUpClick:this._onDownClick,this),g.layerId=b.layerId,c.appendChild(g),g=L.DomUtil.create("div","leaflet-down"),g.layerId=b.layerId,L.DomEvent.on(g,"click","normal"===this.options.order?this._onDownClick:this._onUpClick,this),c.appendChild(g)),i=this._overlaysList):i=this._baseLayersList,i.appendChild(c),d},_onUpClick:function(a){var b=a.currentTarget.layerId,c=this._form.getElementsByTagName("input"),d=this._layers[b];if(d.overlay){for(var e=null,f=this._getZIndex(d),g=0;g<c.length;g++){var h=this._layers[c[g].layerId],i=this._getZIndex(h);if(h.overlay&&f-1===i){e=h;break}}var j=f-1;e&&(d.layer.setZIndex(j),e.layer.setZIndex(j+1),this._map.fire("changeorder",d,this))}},_onDownClick:function(a){var b=a.currentTarget.layerId,c=this._form.getElementsByTagName("input"),d=this._layers[b];if(d.overlay){for(var e=null,f=this._getZIndex(d),g=0;g<c.length;g++){var h=this._layers[c[g].layerId],i=this._getZIndex(h);if(h.overlay&&f+1===i){e=h;break}}var j=f+1;e&&(d.layer.setZIndex(j),e.layer.setZIndex(j-1),this._map.fire("changeorder",d,this))}},_getZIndex:function(a){var b=9999999999;return a.layer.options&&a.layer.options.zIndex?b=a.layer.options.zIndex:a.layer.getLayers&&a.layer.eachLayer&&a.layer.eachLayer(function(a){a.options&&a.options.zIndex&&(b=Math.min(a.options.zIndex,b))}),b},hide:function(){this._container.style.display="none"},show:function(){this._container.style.display=""}}),L.control.orderlayers=function(a,b,c){return new L.Control.OrderLayers(a,b,c)};